<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Barber –ó–∞–ø–∏—Å—å</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 420px;
        margin: 0 auto;
        padding: 20px;
    }

    h2 {
        margin-top: 0;
        font-size: 20px;
        font-weight: 600;
    }

    .times-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    .time-btn {
        padding: 12px 0;
        text-align: center;
        border-radius: 8px;
        background: #222;
        border: 1px solid #333;
        cursor: pointer;
        transition: 0.2s;
    }

    .time-btn:hover {
        background: #333;
    }

    .time-btn.active {
        background: #d4a017;
        color: #000;
        font-weight: bold;
        border-color: #d4a017;
    }

    .address {
        margin-top: 20px;
        font-size: 14px;
        opacity: 0.8;
    }

    .confirm {
        width: 100%;
        padding: 16px 0;
        margin-top: 25px;
        border: none;
        border-radius: 10px;
        background: #d4a017;
        font-size: 17px;
        font-weight: 700;
        cursor: pointer;
    }

    #error_box {
        display: none;
        margin-top: 20px;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        background: #300;
        border: 1px solid #600;
    }
</style>
</head>
<body>

<div class="container">
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>

    <div class="times-grid" id="time_container">
        <div class="time-btn">09:00</div>
        <div class="time-btn">10:00</div>
        <div class="time-btn">11:00</div>
        <div class="time-btn">12:00</div>
        <div class="time-btn">13:00</div>
        <div class="time-btn">14:00</div>
        <div class="time-btn">15:00</div>
        <div class="time-btn">16:00</div>
        <div class="time-btn">17:00</div>
        <div class="time-btn">18:00</div>
    </div>

    <div class="address">
        üìç —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123<br>
        –ü–Ω‚Äì–í—Å 09:00‚Äì19:00
    </div>

    <div id="error_box">
        <b>–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏</b><br>
        –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
    </div>

    <button class="confirm" id="confirm_btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    let selectedTime = null;

    document.querySelectorAll(".time-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".time-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            selectedTime = btn.textContent.trim();
        });
    });

    document.getElementById("confirm_btn").onclick = async function () {
        if (!selectedTime) {
            showError("–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º");
            return;
        }

        const user = tg.initDataUnsafe?.user || {};
        const name = user.first_name || "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
        const phone = user.phone_number || "–ù–µ —É–∫–∞–∑–∞–Ω";
        const uid = user.id || 0;

        const url =
            "https://script.google.com/macros/s/AKfycbzHKZdXNLMsgDunCvA3XZTCbzbt8kfRloN3_vxuzHs49VniNDkgKa7OXuaX-a5VDq48/exec";   /* –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –∏–∑ GAS */

        const body =
            "name=" + encodeURIComponent(name) +
            "&phone=" + encodeURIComponent(phone) +
            "&date=" + encodeURIComponent("–°–ï–ì–û–î–ù–Ø") + 
            "&time=" + encodeURIComponent(selectedTime) +
            "&user_id=" + encodeURIComponent(uid);

        try {
            let response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: body
            });

            let result = await response.json();

            if (result.status === "success") {
                tg.close();
            } else {
                showError(result.message || "–û—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏");
            }

        } catch (e) {
            showError("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.");
        }
    };

    function showError(msg) {
        let box = document.getElementById("error_box");
        box.style.display = "block";
        box.innerHTML = "<b>–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏</b><br>" + msg;
    }
</script>

</body>
</html>
