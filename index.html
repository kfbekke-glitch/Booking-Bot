<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ë–∞—Ä–±–µ—Ä—à–æ–ø ‚Äî –ó–∞–ø–∏—Å—å</title>

<!-- Telegram WebApp SDK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ; –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å) -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent-1:#111827;
    --accent-2:#0f172a;
    --primary-1:#0ea5a4; /* teal */
    --primary-2:#0b7285;
    --danger:#ef4444;
    --radius:14px;
    --shadow: 0 10px 30px rgba(16,24,40,0.06);
    --glass: rgba(255,255,255,0.6);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%}
  body{
    margin:0;
    background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 60%);
    color:var(--accent-2);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
  }
  .wrap{max-width:880px;margin:0 auto;display:grid;grid-template-columns: 1fr 360px;gap:24px;align-items:start}
  @media (max-width:960px){ .wrap{ grid-template-columns: 1fr; padding:12px } }

  /* Left card (main form) */
  .card {
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:22px;
    overflow:hidden;
  }
  .brand {
    display:flex;gap:12px;align-items:center;margin-bottom:6px;
  }
  .logo {
    width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,#111827,#4b5563);display:inline-flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;
  }
  h1{font-size:20px;margin:0;color:var(--accent-2)}
  p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

  .grid { display:grid; gap:14px; grid-template-columns:1fr 1fr; }
  .full { grid-column: 1 / -1; }

  label { display:block; font-weight:600; font-size:13px; color:var(--accent-2); margin-bottom:6px; }
  input[type="text"], input[type="tel"] {
    width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e6edf3;
    background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.95));
    font-size:14px; color:var(--accent-2); box-sizing:border-box;
  }
  .hint { font-size:12px;color:var(--muted); margin-top:6px }

  .dates { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:8px; }
  @media (max-width:520px){ .dates{ grid-template-columns:repeat(2,1fr) } }

  .btn {
    display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:10px;border:1px solid transparent;
    background:#f8fafc;color:var(--accent-2);cursor:pointer;font-weight:600;font-size:13px;
  }
  .btn:disabled{ opacity:0.6; cursor:not-allowed }

  .btn-ghost {
    background:transparent;border:1px dashed #e6edf3;color:var(--muted);
  }

  .btn.primary {
    background: linear-gradient(90deg,var(--primary-1),var(--primary-2)); color:white; border:none;
    box-shadow: 0 8px 28px rgba(6,95,95,0.12);
  }

  .btn.secondary {
    background:#eef2f2;color:var(--primary-2);
  }

  .btn.active {
    transform:translateY(-1px); box-shadow: 0 8px 22px rgba(11,40,60,0.06);
  }

  .times { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-top:10px; }
  @media (max-width:520px){ .times{ grid-template-columns:repeat(3,1fr) } }

  .times button.disabled {
    background: rgba(239,68,68,0.08); color:var(--danger); cursor:not-allowed;
    border:1px solid rgba(239,68,68,0.12);
  }

  .meta { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:14px; color:var(--muted); font-size:13px; }

  /* Right column: info / screens */
  .aside { display:flex;flex-direction:column; gap:16px; }
  .box { padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,250,0.95)); border:1px solid #f0f4f8; }
  .success-icon { width:72px;height:72px;border-radius:20px;background:linear-gradient(90deg,#10b981,#059669);color:white;display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 6px }
  .error-icon { width:72px;height:72px;border-radius:20px;background:linear-gradient(90deg,#ef4444,#dc2626);color:white;display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 6px }

  .hidden { display:none !important; }

  .small { font-size:13px;color:var(--muted) }

  .spinner { width:28px;height:28px;border-radius:50%;border:3px solid #f3f4f6;border-top:3px solid #0ea5a4; animation:spin 1s linear infinite; margin:8px auto; }
  @keyframes spin { to{ transform:rotate(360deg) } }

  footer { margin-top:18px; text-align:center; color:var(--muted); font-size:13px }
</style>
</head>
<body>
  <div class="wrap">
    <!-- MAIN -->
    <div class="card">
      <div class="brand">
        <div class="logo">–ë</div>
        <div>
          <h1>–ë–∞—Ä–±–µ—Ä—à–æ–ø ‚Äî –ó–∞–ø–∏—Å—å</h1>
          <p class="lead">–£–¥–æ–±–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É ‚Äî –≤—ã–±–∏—Ä–∞–π—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</p>
        </div>
      </div>

      <div style="margin-top:14px; display:grid; gap:12px;">
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <div style="flex:1;min-width:220px;">
            <label for="nameInput">–í–∞—à–µ –∏–º—è</label>
            <input id="nameInput" type="text" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
          </div>
          <div style="flex:1;min-width:220px;">
            <label for="phoneInput">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input id="phoneInput" type="tel" placeholder="+7 (999) 123-45-67" value="+7 ">
            <div class="hint">–ó–∞–ø–∏—Å—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞: 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å (–ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ Telegram)</div>
          </div>
        </div>

        <div>
          <label>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</label>
          <div id="datesGrid" class="dates" aria-live="polite"></div>
        </div>

        <div id="timeGroup" class="full hidden">
          <label>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</label>
          <div id="timesGrid" class="times" aria-live="polite">
            <div class="spinner"></div>
          </div>
        </div>

        <div class="meta">
          <div class="small">üìç —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123 ‚Äî –ü–Ω‚Äì–í—Å 09:00‚Äì19:00</div>
          <div>
            <button id="submitBtn" class="btn primary" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ASIDE: success/error/contacts -->
    <div class="aside">
      <div id="infoBox" class="box">
        <div style="font-weight:700;margin-bottom:6px">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="small">–¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67</div>
        <div class="small" style="margin-top:6px">–ê–¥—Ä–µ—Å: —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123</div>
      </div>

      <div id="successBox" class="box hidden">
        <div class="success-icon">‚úì</div>
        <div style="font-weight:700;text-align:center;margin-bottom:6px">–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã!</div>
        <div id="successDetails" class="small" style="text-align:center"></div>
      </div>

      <div id="errorBox" class="box hidden">
        <div class="error-icon">‚ö†</div>
        <div style="font-weight:700;text-align:center;margin-bottom:6px">–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏</div>
        <div id="errorDetails" class="small" style="text-align:center;color:var(--danger)"></div>
      </div>

      <div id="loadingBox" class="box hidden" style="text-align:center">
        <div class="spinner"></div>
        <div class="small">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤‚Ä¶</div>
      </div>
    </div>
  </div>

  <footer>¬© –ë–∞—Ä–±–µ—Ä—à–æ–ø ‚Äî —É–¥–æ–±–Ω–∞—è –∑–∞–ø–∏—Å—å</footer>

<script>
/* ==================== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ==================== */
/* –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ URL –≤–∞—à–µ–≥–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ Google Apps Script (Web app) */
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxVR-YfoxUw2aJdhA00gGSbZradvulZKvhVz2EKZZTDRKidM3C_z1AAwqdAY2HBNEo/exec';

const allTimeSlots = ['09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00'];

/* ==================== –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ==================== */
const booking = { name:'', phone:'', date:'', time:'', userId:null, username:'' };
let bookedSlots = {}; // –∫–ª—é—á–∏ 'YYYY-MM-DD_HH:mm'
let userBookingsToday = []; // –º–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π {name,phone,date,time,userId}
let sending = false;
let tg = window.Telegram?.WebApp || null;

/* ==================== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp ==================== */
if (tg) {
  try { tg.ready(); tg.expand(); }
  catch(e){ /* ignore */ }
  const user = tg.initDataUnsafe?.user || null;
  if (user) {
    booking.userId = user.id || null;
    booking.username = user.username || '';
    const nameEl = document.getElementById('nameInput');
    if (!nameEl.value) nameEl.value = (user.first_name || '') + (user.last_name ? ' ' + user.last_name : '');
  }
}

/* ==================== –£—Ç–∏–ª–∏—Ç—ã ==================== */
function isoDate(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function formatDateForUI(dateStr) {
  const date = new Date(dateStr + 'T00:00:00');
  const today = new Date(); const todayStr = isoDate(today);
  const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate()+1); const tomStr = isoDate(tomorrow);
  if (dateStr === todayStr) return '–°–µ–≥–æ–¥–Ω—è';
  if (dateStr === tomStr) return '–ó–∞–≤—Ç—Ä–∞';
  return date.toLocaleDateString('ru-RU',{weekday:'short', day:'numeric', month:'short'});
}
function normalizePhone(raw) {
  if (!raw) return '';
  let digits = raw.toString().replace(/\D/g,'');
  if (digits.startsWith('8')) digits = '7' + digits.slice(1);
  if (!digits.startsWith('7')) digits = '7' + digits;
  digits = digits.slice(0,11);
  if (digits.length !== 11) return ''; // –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
  return '+' + digits;
}
function showElement(id){ document.getElementById(id).classList.remove('hidden'); }
function hideElement(id){ document.getElementById(id).classList.add('hidden'); }

/* ==================== –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º ==================== */
async function loadBookedSlots() {
  // –ü–æ–∫–∞–∂–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
  showElement('loadingBox');
  try {
    const res = await fetch(GOOGLE_SCRIPT_URL + '?action=getBookings', {cache:'no-store'});
    if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
    const data = await res.json();
    bookedSlots = {};
    userBookingsToday = [];
    if (data && Array.isArray(data.bookings)) {
      data.bookings.forEach(b => {
        // –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º: b.date = 'yyyy-mm-dd', b.time='HH:mm'
        const key = `${b.date}_${b.time}`;
        bookedSlots[key] = true;
        userBookingsToday.push({
          name: b.name || '',
          phone: normalizePhone(b.phone || ''),
          date: b.date || '',
          time: b.time || '',
          userId: b.userId || null
        });
      });
    }
    hideElement('loadingBox');
    return true;
  } catch (err) {
    console.error('loadBookedSlots error', err);
    hideElement('loadingBox');
    // –û—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Å–æ–ª–∏
    return false;
  }
}

/* ==================== –õ–æ–≥–∏–∫–∞ –¥–∞—Ç/–≤—Ä–µ–º—ë–Ω ==================== */
function getAvailableDays() {
  const days = [];
  const now = new Date();
  const currentHour = now.getHours();
  const start = currentHour >= 18 ? 1 : 0;
  for (let i=start;i<start+7;i++){
    const d = new Date(); d.setDate(d.getDate()+i);
    days.push(isoDate(d));
  }
  return days;
}
function isSlotBooked(date, time) {
  return bookedSlots[`${date}_${time}`] === true;
}
function getAvailableTimeSlots(selectedDate) {
  const now = new Date();
  const todayStr = isoDate(now);
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();
  return allTimeSlots.filter(slot=>{
    if (isSlotBooked(selectedDate, slot)) return false;
    if (selectedDate === todayStr) {
      const [h,m] = slot.split(':').map(Number);
      const slotTime = new Date(); slotTime.setHours(h,m,0,0);
      const minAllowed = new Date(); minAllowed.setHours(currentHour+1,currentMinute,0,0);
      if (slotTime < minAllowed) return false;
    }
    return true;
  });
}

/* ==================== –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI ==================== */
function renderDates() {
  const grid = document.getElementById('datesGrid');
  const days = getAvailableDays();
  grid.innerHTML = days.map(d=>`<button class="btn btn-ghost" onclick="selectDate('${d}', this)">${formatDateForUI(d)}</button>`).join('');
}
function renderTimes() {
  const grid = document.getElementById('timesGrid');
  const available = getAvailableTimeSlots(booking.date);
  if (!available.length) {
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--danger);font-weight:700;padding:8px">‚ùå –ù–∞ —ç—Ç—É –¥–∞—Ç—É –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã.</div>';
    return;
  }
  grid.innerHTML = allTimeSlots.map(t=>{
    const isAvailable = available.includes(t);
    const cls = isAvailable ? 'btn secondary' : 'btn disabled';
    const disabled = isAvailable ? '' : 'disabled';
    const title = isAvailable ? '–î–æ—Å—Ç—É–ø–Ω–æ' : (isSlotBooked(booking.date,t) ? '–ó–∞–Ω—è—Ç–æ' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
    return `<button class="${cls}" ${disabled} onclick="${isAvailable?`selectTime('${t}', this)`:'return false'}" title="${title}">${t}</button>`;
  }).join('');
}

/* ==================== –í—ã–±–æ—Ä –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏ ==================== */
async function selectDate(date, el){
  booking.date = date;
  booking.time = '';
  document.querySelectorAll('#datesGrid .btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('timeGroup').classList.remove('hidden');
  document.getElementById('timesGrid').innerHTML = '<div class="spinner"></div>';
  await loadBookedSlots();
  renderTimes();
  updateSubmitButton();
}
function selectTime(time, el){
  booking.time = time;
  document.querySelectorAll('#timesGrid .btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  updateSubmitButton();
}

/* ==================== –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π ==================== */
const nameInput = document.getElementById('nameInput');
const phoneInput = document.getElementById('phoneInput');
nameInput.addEventListener('input', (e)=>{ booking.name = e.target.value.trim(); updateSubmitButton(); });

phoneInput.addEventListener('input', e=>{
  // –ø—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
  let v = e.target.value.replace(/\D/g,'');
  if (v.startsWith('8')) v = '7'+v.slice(1);
  if (!v.startsWith('7')) v = '7'+v;
  v = v.slice(0,11);
  let fmt = '+7 ';
  if (v.length > 1) fmt += '(' + v.substring(1,4);
  if (v.length >= 5) fmt += ') ' + v.substring(4,7);
  if (v.length >= 8) fmt += '-' + v.substring(7,9);
  if (v.length >= 10) fmt += '-' + v.substring(9,11);
  e.target.value = fmt;
  booking.phone = normalizePhone(fmt);
  updateSubmitButton();
});
phoneInput.addEventListener('keydown', (e)=>{ const pos = e.target.selectionStart; if ((e.key==='Backspace'||e.key==='Delete') && pos<=3) e.preventDefault(); });

function checkUserBookingLimit(phone, userId){
  const today = isoDate(new Date());
  const phoneBookings = userBookingsToday.filter(b => b.phone === phone && b.date === today);
  const userIdBookings = userId ? userBookingsToday.filter(b => b.userId && String(b.userId) === String(userId) && b.date === today) : [];
  return phoneBookings.length > 0 || userIdBookings.length > 0;
}

function updateSubmitButton(){
  const btn = document.getElementById('submitBtn');
  const valid = booking.name && booking.phone && booking.date && booking.time;
  btn.disabled = !valid || sending;
  if (tg && typeof tg.MainButton !== 'undefined') {
    try {
      if (valid) { tg.MainButton.setText('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å ‚úÖ'); tg.MainButton.show(); tg.MainButton.onClick(handleSubmit); }
      else tg.MainButton.hide();
    } catch(e){}
  }
}

/* ==================== –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä ==================== */
async function handleSubmit(){
  if (sending) return;
  // –û–±–Ω–æ–≤–∏–º –ø–æ–ª—è –∏–∑ DOM
  booking.name = nameInput.value.trim();
  booking.phone = normalizePhone(phoneInput.value);

  // –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
  await loadBookedSlots(); // –æ–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  if (checkUserBookingLimit(booking.phone, booking.userId)) {
    showError('–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –ø–æ —ç—Ç–æ–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ Telegram ID.');
    return;
  }
  // –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ—Ç–∞
  if (isSlotBooked(booking.date, booking.time)) {
    showError('–≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ. –û–±–Ω–æ–≤–∏–ª —Å–ø–∏—Å–æ–∫ ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–ª–æ—Ç.');
    return;
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ payload
  const payload = {
    name: booking.name,
    phone: booking.phone,
    date: booking.date,
    time: booking.time,
    userId: booking.userId || '',
    username: booking.username || '',
    createdAt: new Date().toLocaleString('ru-RU')
  };

  sending = true;
  updateSubmitButton();
  document.getElementById('submitBtn').textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

  try {
    const res = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    if (result && result.status === 'success') {
      // –û–±–Ω–æ–≤–ª—è–µ–º UI
      bookedSlots[`${payload.date}_${payload.time}`] = true;
      userBookingsToday.push({ name: payload.name, phone: payload.phone, date: payload.date, time: payload.time, userId: payload.userId || null });

      // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –±–ª–æ–∫
      hideElement('errorBox'); showElement('successBox');
      document.getElementById('successDetails').innerHTML = `
        <div><strong>${payload.name}</strong></div>
        <div style="margin-top:6px">${payload.phone} ‚Ä¢ ${formatDateForUI(payload.date)} ‚Ä¢ ${payload.time}</div>
      `;
      // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É
      document.querySelector('.card').classList.add('hidden');
      // Telegram sendData –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
      if (tg && typeof tg.sendData === 'function') {
        try { tg.sendData(JSON.stringify(payload)); } catch(e){}
      }
    } else {
      const msg = result && result.message ? result.message : '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
      showError(msg);
    }
  } catch (err) {
    console.error('send error', err);
    showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
  } finally {
    sending = false;
    document.getElementById('submitBtn').textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å';
    updateSubmitButton();
  }
}

/* ==================== UI –û—à–∏–±–∫–∏/–£—Å–ø–µ—Ö ==================== */
function showError(msg){
  document.getElementById('errorDetails').textContent = msg;
  showElement('errorBox');
  hideElement('successBox');
}
function showInfo(msg){
  // –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  console.info(msg);
}

/* ==================== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ==================== */
(async function init(){
  renderDates();
  await loadBookedSlots();
  // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  if (nameInput.value) booking.name = nameInput.value.trim();
  booking.phone = normalizePhone(phoneInput.value);
  updateSubmitButton();
})();

/* –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è inline onclick –≤ —Ä–∞–∑–º–µ—Ç–∫–µ */
window.selectDate = selectDate;
window.selectTime = selectTime;
window.handleSubmit = handleSubmit;

</script>
</body>
</html>
